<!DOCTYPE html>
<html lang="en">
  <head>
    <title>dbks - Business Processes as Types, Let's Explore</title>
   	<meta name="description" content="Business Processes as Types, Let's Explore" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <meta content="utf-8" http-equiv="encoding" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/base16/danqing.min.css" />
    <link rel="stylesheet" href="/s/style.css" />
  </head>
  <body>
    <div id="title">
      <a href="/"><img alt="dbks logo" src="/i/dbks.png" /></a> <a href="/"><h1>deathbykeystroke</h1></a>
    </div>
    <div id="article">
      <h1>Business Processes as Types, Let's Explore</h1>
      <h6>// date:  2022-05-17</h6>
      <h6>// filed: <a href="/tags/golang.html">golang</a>, <a href="/tags/programming.html">programming</a></h6>
      <h6>// <a href="https://deathbykeystroke.com/articles/20220517-business-processes-as-types-lets-explore.html">perma</a></h6>
      <br/>

      <p>A conversation arose where business processes <em>as</em> type safe
mutators is possible but too complicated to do in practice. It doesn't
have to be and, in fact, isn't that difficult to do if you spend some
time thinking prior to hamfisting the keyboard.</p>
<p>Usually what is found on the subject is something <em>easy</em> to do
that might fail at some point and then you're on your own. The
boilerplate is difficult to read, the difference in thinking from
standard ways of doing things is glossed over, and you've wasted 15
minutes trying to understand what the author is thinking.</p>
<p>For this article we're going to focus on:</p>
<ol>
<li>readability</li>
<li>ergonomics</li>
<li>no more <code>if err != nil ...</code> litter</li>
</ol>
<h2 id="building-a-foundation">Building a Foundation</h2>
<p>We need a different way of thinking about our problems, it's very
familiar but a weird concept in programming to think: "we'll try to do
<em>something</em>, see if there's an error, try to do <em>something
else</em>, see if there's an error" and so on. Let's start thinking
about problems in a way that is "let's perform some setup, try to
perform our <em>process</em>, and then handle any errors that happened
at any point during the operation". In order to do this we're going to
have to think about what data is required to perform some operation and
then allow methods to fail while still mutating the output to the next
expected input. This is something functional languages get for free and
some are better at it than others, in go we can write our own
<code>Either</code> type (in <code>either/either.go</code>):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> either</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> WHICH <span class="dt">int64</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    LEFT WHICH <span class="op">=</span> <span class="ot">iota</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    RIGHT</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Either<span class="op">[</span>L<span class="op">,</span> R any<span class="op">]</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    isLeft <span class="dt">bool</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    left   L</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    right  R</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> EitherInterface<span class="op">[</span>L<span class="op">,</span> R any<span class="op">]</span> <span class="kw">interface</span> <span class="op">{</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    Which<span class="op">()</span> WHICH</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    Left<span class="op">()</span> L</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    Right<span class="op">()</span> R</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Left<span class="op">[</span>L<span class="op">,</span> R any<span class="op">](</span>l L<span class="op">)</span> Either<span class="op">[</span>L<span class="op">,</span> R<span class="op">]</span> <span class="op">{</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> Either<span class="op">[</span>L<span class="op">,</span> R<span class="op">]{</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        isLeft<span class="op">:</span> <span class="ot">true</span><span class="op">,</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        left<span class="op">:</span>   l<span class="op">,</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Right<span class="op">[</span>L<span class="op">,</span> R any<span class="op">](</span>r R<span class="op">)</span> Either<span class="op">[</span>L<span class="op">,</span> R<span class="op">]</span> <span class="op">{</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> Either<span class="op">[</span>L<span class="op">,</span> R<span class="op">]{</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        right<span class="op">:</span> r<span class="op">,</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>e Either<span class="op">[</span>L<span class="op">,</span> R<span class="op">])</span> Which<span class="op">()</span> WHICH <span class="op">{</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> e<span class="op">.</span>isLeft <span class="op">{</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> LEFT</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> RIGHT</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>e Either<span class="op">[</span>L<span class="op">,</span> R<span class="op">])</span> Left<span class="op">()</span> L <span class="op">{</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> e<span class="op">.</span>left</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>e Either<span class="op">[</span>L<span class="op">,</span> R<span class="op">])</span> Right<span class="op">()</span> R <span class="op">{</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> e<span class="op">.</span>right</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Now we're cooking. The <code>Either</code> type gives us
<code>LEFT|RIGHT</code> branches. There exists many ways to use this but
for this article we're going to assume that once our object is in the
<code>RIGHT</code> branch we do not want to further process. It also
takes advantage of generics so that you do not have to write the same
code over again with all of your types.</p>
<h2 id="business-processes">Business Processes</h2>
<figure>
<img src="/i/bp.png" alt="Order Fulfillment Process" />
<figcaption aria-hidden="true">Order Fulfillment Process</figcaption>
</figure>
<p>Let's do something more complicated than your usual. This is
<em>non-trivial</em> but you'll see it can be boiled down to a call
chain that is easily debugged, easy to read, and looks like
<code>.Quantity(itemID).Procure(itemID, qty).Ship(itemID, qty).Invoice()</code>.
Wowsers, let's write our example inventory system. Obviously, in
practice, the signatures here would change and you'd have stuff like an
address to ship to. In <code>inventory/inventory.go</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> inventory</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;github.com/pkg/errors&quot;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;deathbykeystroke.com/either/either&quot;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Our Demo _DB_ - no promise of thread safe or anything else</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Inventory <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    onHand<span class="op">,</span> onOrder <span class="dt">int</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> inventory <span class="kw">map</span><span class="op">[</span><span class="dt">int</span><span class="op">]*</span>Inventory <span class="op">=</span> <span class="kw">map</span><span class="op">[</span><span class="dt">int</span><span class="op">]*</span>Inventory<span class="op">{</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="dv">10</span><span class="op">:</span> <span class="op">&amp;</span>Inventory<span class="op">{</span>onHand<span class="op">:</span> <span class="dv">100</span><span class="op">},</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="dv">20</span><span class="op">:</span> <span class="op">&amp;</span>Inventory<span class="op">{</span>onHand<span class="op">:</span> <span class="dv">50</span><span class="op">},</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="dv">30</span><span class="op">:</span> <span class="op">&amp;</span>Inventory<span class="op">{</span>onHand<span class="op">:</span> <span class="dv">1</span><span class="op">},</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="dv">40</span><span class="op">:</span> <span class="op">&amp;</span>Inventory<span class="op">{</span>onHand<span class="op">:</span> <span class="dv">0</span><span class="op">},</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Track an order result so that later we may notify the customer</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> OrderResult <span class="dt">int</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> <span class="op">(</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    UnableToProcure OrderResult <span class="op">=</span> <span class="ot">iota</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    Ordered</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    Fulfilled</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> OrderResultStrings <span class="op">=</span> <span class="kw">map</span><span class="op">[</span>OrderResult<span class="op">]</span><span class="dt">string</span><span class="op">{</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    UnableToProcure<span class="op">:</span> <span class="st">&quot;Unable to procure&quot;</span><span class="op">,</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    Ordered<span class="op">:</span>         <span class="st">&quot;Ordered&quot;</span><span class="op">,</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    Fulfilled<span class="op">:</span>       <span class="st">&quot;Fulfilled&quot;</span><span class="op">,</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co">// Create types and implement the EitherInterface so that we can use the Either[x,y] as receivers</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">// and maintain type/mutation safety in our call chain.</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co">// We really want the compiler to ensure that our (in -&gt; out) matches our chaining pattern.</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> InventoryQuantity either<span class="op">.</span>Either<span class="op">[*</span>Inventory<span class="op">,</span> <span class="dt">error</span><span class="op">]</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> InventoryOrderResult either<span class="op">.</span>Either<span class="op">[</span>OrderResult<span class="op">,</span> <span class="dt">error</span><span class="op">]</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> InventoryProcurementResult either<span class="op">.</span>Either<span class="op">[</span>Inventory<span class="op">,</span> <span class="dt">error</span><span class="op">]</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>i InventoryQuantity<span class="op">)</span> Which<span class="op">()</span> either<span class="op">.</span>WHICH <span class="op">{</span> <span class="kw">return</span> either<span class="op">.</span>Either<span class="op">[*</span>Inventory<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>i<span class="op">).</span>Which<span class="op">()</span> <span class="op">}</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>i InventoryQuantity<span class="op">)</span> Left<span class="op">()</span> <span class="op">*</span>Inventory    <span class="op">{</span> <span class="kw">return</span> either<span class="op">.</span>Either<span class="op">[*</span>Inventory<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>i<span class="op">).</span>Left<span class="op">()</span> <span class="op">}</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>i InventoryQuantity<span class="op">)</span> Right<span class="op">()</span> <span class="dt">error</span>        <span class="op">{</span> <span class="kw">return</span> either<span class="op">.</span>Either<span class="op">[*</span>Inventory<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>i<span class="op">).</span>Right<span class="op">()</span> <span class="op">}</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>i InventoryOrderResult<span class="op">)</span> Which<span class="op">()</span> either<span class="op">.</span>WHICH <span class="op">{</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> either<span class="op">.</span>Either<span class="op">[</span>OrderResult<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>i<span class="op">).</span>Which<span class="op">()</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>i InventoryOrderResult<span class="op">)</span> Left<span class="op">()</span> OrderResult <span class="op">{</span> <span class="kw">return</span> either<span class="op">.</span>Either<span class="op">[</span>OrderResult<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>i<span class="op">).</span>Left<span class="op">()</span> <span class="op">}</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>i InventoryOrderResult<span class="op">)</span> Right<span class="op">()</span> <span class="dt">error</span>      <span class="op">{</span> <span class="kw">return</span> either<span class="op">.</span>Either<span class="op">[</span>OrderResult<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>i<span class="op">).</span>Right<span class="op">()</span> <span class="op">}</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a><span class="co">// Quantity retrieves an inventory object from our &quot;db&quot;</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Quantity<span class="op">(</span>id <span class="dt">int</span><span class="op">)</span> InventoryQuantity <span class="op">{</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> inv<span class="op">,</span> ok <span class="op">:=</span> inventory<span class="op">[</span>id<span class="op">];</span> ok <span class="op">{</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> InventoryQuantity<span class="op">(</span>either<span class="op">.</span>Left<span class="op">[*</span>Inventory<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>inv<span class="op">))</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="co">// We return a RIGHT value here so whatever the consumer is knows this is a failed value,</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  <span class="co">// remember: we&#39;re ignoring RIGHT values and handling the error all at once regardless of</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">// what threw the error. </span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> InventoryQuantity<span class="op">(</span>either<span class="op">.</span>Right<span class="op">[*</span>Inventory<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>errors<span class="op">.</span>Errorf<span class="op">(</span><span class="st">&quot;no record of id: %d&quot;</span><span class="op">,</span> id<span class="op">)))</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="co">// Procure short circuits on RIGHT and because `i` is already in a failure state, we just move</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="co">// down the chain because Procure has no business handling an error in its caller.</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>i InventoryQuantity<span class="op">)</span> Procure<span class="op">(</span>id<span class="op">,</span> n <span class="dt">int</span><span class="op">)</span> InventoryQuantity <span class="op">{</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> i<span class="op">.</span>Which<span class="op">()</span> <span class="op">==</span> either<span class="op">.</span>RIGHT <span class="op">{</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> i</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    invN <span class="op">:=</span> i<span class="op">.</span>Left<span class="op">()</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> id <span class="op">&gt;=</span> <span class="dv">30</span> <span class="op">&amp;&amp;</span> invN<span class="op">.</span>onHand <span class="op">&lt;</span> n <span class="op">&amp;&amp;</span> invN<span class="op">.</span>onOrder <span class="op">&lt;</span> n <span class="op">{</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> InventoryQuantity<span class="op">(</span>either<span class="op">.</span>Right<span class="op">[*</span>Inventory<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>errors<span class="op">.</span>Errorf<span class="op">(</span><span class="st">&quot;cannot order id: %d&quot;</span><span class="op">,</span> id<span class="op">)))</span></span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> n <span class="op">&gt;</span> invN<span class="op">.</span>onHand <span class="op">{</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>        <span class="co">// do some procurement process</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>        <span class="op">(*</span>invN<span class="op">).</span>onOrder <span class="op">+=</span> n</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> InventoryQuantity<span class="op">(</span>either<span class="op">.</span>Left<span class="op">[*</span>Inventory<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>invN<span class="op">))</span></span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> InventoryQuantity<span class="op">(</span>either<span class="op">.</span>Left<span class="op">[*</span>Inventory<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>invN<span class="op">))</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> InventoryQuantity<span class="op">(</span>either<span class="op">.</span>Right<span class="op">[*</span>Inventory<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>errors<span class="op">.</span>Errorf<span class="op">(</span><span class="st">&quot;no record of id: %d&quot;</span><span class="op">,</span> id<span class="op">)))</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a><span class="co">// Ship reduces the inventory quantity onHand or onOrder depending on what is available, again</span></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="co">// ignoring any RIGHT sided Either</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>i InventoryQuantity<span class="op">)</span> Ship<span class="op">(</span>id<span class="op">,</span> n <span class="dt">int</span><span class="op">)</span> InventoryOrderResult <span class="op">{</span></span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    inv <span class="op">:=</span> i<span class="op">.</span>Left<span class="op">()</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> i<span class="op">.</span>Which<span class="op">()</span> <span class="op">==</span> either<span class="op">.</span>RIGHT <span class="op">||</span> <span class="op">(</span>inv<span class="op">.</span>onHand <span class="op">&lt;</span> n <span class="op">&amp;&amp;</span> inv<span class="op">.</span>onOrder <span class="op">&lt;</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> InventoryOrderResult<span class="op">(</span>either<span class="op">.</span>Left<span class="op">[</span>OrderResult<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>UnableToProcure<span class="op">))</span></span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> inv<span class="op">.</span>onHand <span class="op">&gt;=</span> n <span class="op">{</span></span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>        <span class="op">(*</span>inv<span class="op">).</span>onHand <span class="op">-=</span> n</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> InventoryOrderResult<span class="op">(</span>either<span class="op">.</span>Left<span class="op">[</span>OrderResult<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>Fulfilled<span class="op">))</span></span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    <span class="op">(*</span>inv<span class="op">).</span>onOrder <span class="op">-=</span> n</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> InventoryOrderResult<span class="op">(</span>either<span class="op">.</span>Left<span class="op">[</span>OrderResult<span class="op">,</span> <span class="dt">error</span><span class="op">](</span>Ordered<span class="op">))</span></span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a><span class="co">// Invoice should create an invoice somewhere for the customer.  In reality Quantity should be</span></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="co">// gathering the related inventory and then either the caller or some process should be enriching</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a><span class="co">// this object with the customer data.</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>i InventoryOrderResult<span class="op">)</span> Invoice<span class="op">()</span> InventoryOrderResult <span class="op">{</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> i<span class="op">.</span>Which<span class="op">()</span> <span class="op">==</span> either<span class="op">.</span>LEFT <span class="op">&amp;&amp;</span> i<span class="op">.</span>Left<span class="op">()</span> <span class="op">==</span> Fulfilled <span class="op">{</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Create an invoice</span></span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> i</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a><span class="co">// String returns LEFT -&gt; enum as a string, RIGHT -&gt; error as a string</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="op">(</span>i InventoryOrderResult<span class="op">)</span> String<span class="op">()</span> <span class="dt">string</span> <span class="op">{</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> i<span class="op">.</span>Which<span class="op">()</span> <span class="op">==</span> either<span class="op">.</span>RIGHT <span class="op">{</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> i<span class="op">.</span>Right<span class="op">().</span>Error<span class="op">()</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> OrderResultStrings<span class="op">[</span>i<span class="op">.</span>Left<span class="op">()]</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>There's a lot to unpack in this code. First, we create our inventory
- a map that contains our inventory info. Then we create our types of
<code>Either</code>s, then we create the receiver functions that can
operate on those types. Each step is commented in the code to give
clarity while the code is being read. You'll notice that each
<code>func</code> with an <code>Either</code> receiver short circuits on
a <code>RIGHT</code> value. This is desirable so we don't break our
chain and it's something that pattern matching functional languages get
for free. We don't so we'll do it this way for now. Another tactic for
getting this is writing <code>Lift</code>ers that can take pure
functions and essentially add/remove the value from our
<code>Either</code>. We're not going to do that right now because go's
support for generics and receivers is not great.</p>
<p>From the function signatures you'll see that you can chain together
everything as: <code>.Quantity.Procure.Ship.Invoice</code> and no matter
what state our order is in, if the item is unattainable or not
available, <em>nothing</em> happens to the inventory, and no invoice
will be generated.</p>
<h2 id="putting-our-design-to-use">Putting Our Design to Use</h2>
<p>Let's write a test to see if we get what we expect, in
<code>main.go</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode go"><code class="sourceCode go"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span> main</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="op">(</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;fmt&quot;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;os&quot;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;deathbykeystroke.com/either/either&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;deathbykeystroke.com/either/inventory&quot;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Order !! Our business process as a type safe, readable, and reliable call chain:</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> Order<span class="op">(</span>id <span class="dt">int</span><span class="op">,</span> n <span class="dt">int</span><span class="op">)</span> inventory<span class="op">.</span>InventoryOrderResult <span class="op">{</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> inventory<span class="op">.</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        Quantity<span class="op">(</span>id<span class="op">).</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        Procure<span class="op">(</span>id<span class="op">,</span> n<span class="op">).</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        Ship<span class="op">(</span>id<span class="op">,</span> n<span class="op">).</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        Invoice<span class="op">()</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">// Set up some test data</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> test <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    id<span class="op">,</span> qty <span class="dt">int</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">// Nicely output if test fails/passes</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> passFail <span class="op">=</span> <span class="kw">map</span><span class="op">[</span><span class="dt">bool</span><span class="op">]</span><span class="dt">string</span><span class="op">{</span><span class="ot">false</span><span class="op">:</span> <span class="st">&quot;FAIL&quot;</span><span class="op">,</span> <span class="ot">true</span><span class="op">:</span> <span class="st">&quot;PASS&quot;</span><span class="op">}</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Test Cases</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    tests <span class="op">:=</span> <span class="op">[]</span>test<span class="op">{</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span>id<span class="op">:</span> <span class="dv">10</span><span class="op">,</span> qty<span class="op">:</span> <span class="dv">101</span><span class="op">},</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span>id<span class="op">:</span> <span class="dv">10</span><span class="op">,</span> qty<span class="op">:</span> <span class="dv">50</span><span class="op">},</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span>id<span class="op">:</span> <span class="dv">20</span><span class="op">,</span> qty<span class="op">:</span> <span class="dv">50</span><span class="op">},</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span>id<span class="op">:</span> <span class="dv">30</span><span class="op">,</span> qty<span class="op">:</span> <span class="dv">2</span><span class="op">},</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span>id<span class="op">:</span> <span class="dv">30</span><span class="op">,</span> qty<span class="op">:</span> <span class="dv">1</span><span class="op">},</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span>id<span class="op">:</span> <span class="dv">40</span><span class="op">,</span> qty<span class="op">:</span> <span class="dv">5</span><span class="op">},</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>    expects <span class="op">:=</span> <span class="op">[]</span>inventory<span class="op">.</span>OrderResult<span class="op">{</span>inventory<span class="op">.</span>Ordered<span class="op">,</span> inventory<span class="op">.</span>Fulfilled<span class="op">,</span> inventory<span class="op">.</span>Fulfilled<span class="op">,</span> inventory<span class="op">.</span>UnableToProcure<span class="op">,</span> inventory<span class="op">.</span>Fulfilled<span class="op">,</span> inventory<span class="op">.</span>UnableToProcure<span class="op">}</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    pass <span class="op">:=</span> <span class="ot">true</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="kw">for</span> i<span class="op">,</span> test <span class="op">:=</span> <span class="kw">range</span> tests <span class="op">{</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>        result <span class="op">:=</span> Order<span class="op">(</span>test<span class="op">.</span>id<span class="op">,</span> test<span class="op">.</span>qty<span class="op">)</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="co">// None of our tests should ever result in RIGHT (there is no `error` thrown anywhere)</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> result<span class="op">.</span>Which<span class="op">()</span> <span class="op">==</span> either<span class="op">.</span>RIGHT <span class="op">||</span> result<span class="op">.</span>Left<span class="op">()</span> <span class="op">!=</span> expects<span class="op">[</span>i<span class="op">]</span> <span class="op">{</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>            pass <span class="op">=</span> <span class="ot">false</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>        fmt<span class="op">.</span>Printf<span class="op">(</span><span class="st">&quot;[%s] ordering %d, qty: %d =&gt; %+v</span><span class="ch">\n</span><span class="st">&quot;</span><span class="op">,</span> passFail<span class="op">[</span>result<span class="op">.</span>Which<span class="op">()</span> <span class="op">==</span> either<span class="op">.</span>RIGHT <span class="op">||</span> expects<span class="op">[</span>i<span class="op">]</span> <span class="op">==</span> result<span class="op">.</span>Left<span class="op">()],</span> test<span class="op">.</span>id<span class="op">,</span> test<span class="op">.</span>qty<span class="op">,</span> result<span class="op">.</span>String<span class="op">())</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">!</span>pass <span class="op">{</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>        fmt<span class="op">.</span>Fprintf<span class="op">(</span>os<span class="op">.</span>Stderr<span class="op">,</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">FAIL</span><span class="ch">\n</span><span class="st">&quot;</span><span class="op">)</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        os<span class="op">.</span>Exit<span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">.</span>Fprintf<span class="op">(</span>os<span class="op">.</span>Stderr<span class="op">,</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">PASS</span><span class="ch">\n</span><span class="st">&quot;</span><span class="op">)</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>    os<span class="op">.</span>Exit<span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>When we <code>go run main.go</code>:</p>
<pre><code>[PASS] ordering 10, qty: 101 =&gt; Ordered
[PASS] ordering 10, qty: 50 =&gt; Fulfilled
[PASS] ordering 20, qty: 50 =&gt; Fulfilled
[PASS] ordering 30, qty: 2 =&gt; Unable to procure
[PASS] ordering 30, qty: 1 =&gt; Fulfilled
[PASS] ordering 40, qty: 5 =&gt; Unable to procure

PASS</code></pre>
<p>We get what we expected, everything under id:30 is procurable so we
get <code>Ordered</code> when not in stock, it's <code>Fulfilled</code>
when in stock, and <code>Unable to procure</code> when the item is not
in stock and we cannot order it.</p>
<p>All three branches of our business process tree are now handled and
all three termination points within one call chain.</p>
<p>"Yea but hey! most of this business process <em>can</em> follow the
same pattern, what about something that doesn't?" There isn't much that
doesn't and in the case where you should follow very different logic
then you have the fallback to <code>switch result.Which()</code> and
follow the chains that way but this should be an exception if you're
thinking clearly.</p>
<p>That about does it for the business process as types. This shift in
thinking is possible in most languages but it does require some
forethought about the what the process is and what data is needed
throughout the chain.</p>


    </div>
    <div id="footer">
      <h6>// social twitter:<a href="https://twitter.com/oynoto">@oynoto</a>, patreon:<a href="https://www.patreon.com/oynot">@oynot</a>, github:<a href="https://github.com/tony-o">tony-o</a></h6>
    </div>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
    <script src="/s/hljs-raku.js"></script>
    <script>
      hljs.registerLanguage("raku", hljs_raku);
      (function(){
        languages = {}
        pres      = document.getElementsByTagName("pre");
        for(i = 0; i < hljs.listLanguages().length; i++){
          languages['language-' + hljs.listLanguages()[i]] = 1;
        }
        for(i = 0; i < pres.length; i++){
          pre = pres[i];
          cn  = 'language-plaintext';
          ls  = (pre.getAttribute("class") || 'plaintext').split(' ');
          for(j = 0; j < ls.length; j++){
            if(languages['language-' + ls[j]]){
              cn = 'language-' + ls[j];
              break;
            }
          }
          codes = pre.getElementsByTagName("code")
          for(j = 0; j < codes.length; j++){
            codes[j].setAttribute("class", (codes[j].getAttribute("class") + " hljs " + cn).trim())
          }
        }
        hljs.highlightAll();
      })();
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FKJQZPJ2XK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-FKJQZPJ2XK');
    </script>

  </body>
</html>
