<!DOCTYPE html>
<html lang="en">
  <head>
    <title>dbks - Virtual Environments in Raku</title>
   	<meta name="description" content="Virtual Environments in Raku" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <meta content="utf-8" http-equiv="encoding" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/base16/danqing.min.css" />
    <link rel="stylesheet" href="/s/style.css" />
  </head>
  <body>
    <div id="title">
      <a href="/"><img alt="dbks logo" src="/i/dbks.png" /></a> <a href="/"><h1>deathbykeystroke</h1></a>
    </div>
    <div id="article">
      <h1>Virtual Environments in Raku</h1>
      <h6>// date:  2022-12-05</h6>
      <h6>// filed: <a href="/tags/rakudo.html">rakudo</a>, <a href="/tags/programming.html">programming</a></h6>
      <h6>// <a href="https://deathbykeystroke.com/articles/20221205-virtual-environments-in-raku.html">perma</a></h6>
      <br/>

      <h1 id="virtual-environments-in-raku">Virtual Environments in Raku</h1>
<p>Envious? If not, run <code>zef install Envy</code> and let's start exploring virtual comp unit repositories.</p>
<p>Hold the phone! What are we doing? We're going to explore using a module allowing us to have virtual module environments in our very favorite raku.</p>
<p>Why do we want this? Many reasons but a few would include:</p>
<ul>
<li>development &amp; testing environments</li>
<li>isolating module repositories by project/environment/something else</li>
<li>using multiple versions of raku more safely</li>
</ul>
<p>Sold? Continue on!</p>
<h2 id="getting-started">Getting Started</h2>
<p>Installing the environment manager is easy enough with <code>zef install Envy</code>. Now for this tutorial we're going to build an interprocess worker pool that doesn't do anything but instead of installing everything globally, we'll get it done with a custom module repository.</p>
<p>In <code>parent.raku</code> dump the following:</p>
<pre class="raku"><code>use Event::Emitter::Inter-Process;

my $event = Event::Emitter::Inter-Process.new;

my Proc::Async $child .=new(:w, &#39;raku&#39;, &#39;-Ilib&#39;, &#39;child.raku&#39;);

$event.hook($child);

$event.on(&#39;echo&#39;, -&gt; $data {
  # got $data from child;
  say $data.decode;
});

$child.start;
sleep 1;


$event.emit(&#39;echo&#39;.encode, &#39;hello&#39;.encode);
$event.emit(&#39;echo&#39;.encode, &#39;world&#39;.encode);

sleep 5;</code></pre>
<p>And then in <code>child.raku</code>:</p>
<pre class="raku"><code>use Event::Emitter::Inter-Process;

my $event = Event::Emitter::Inter-Process.new(:sub-process);

$event.on(&#39;echo&#39;, -&gt; $data {
  &quot;child echo: {$data.decode}&quot;.say;
  $event.emit(&#39;echo&#39;.encode, $data);
});

sleep 3;</code></pre>
<p>Okay, it's just the sample code but the program is not the focus. On to installing <code>Event::Emitter::Inter-Process</code> to a virtual repo.</p>
<p>We need to create an environment and enable it before we can install our dependencies to it:</p>
<pre><code>$ envy init tutorial
==&gt; created tutorial
    to install to this repo with zef use:
      zef install --to=&#39;Envy#tutorial&#39; &lt;your modules&gt;
$ envy enable tutorial
==&gt; Enabled repositories: tutorial
$ zef install --to=&#39;Envy#tutorial&#39; &#39;Event::Emitter::Inter-Process&#39;
===&gt; Searching for: Event::Emitter::Inter-Process
===&gt; Searching for missing dependencies: Event::Emitter
===&gt; Testing: Event::Emitter:ver&lt;1.0.3&gt;:auth&lt;zef:tony-o&gt;
===&gt; Testing [OK] for Event::Emitter:ver&lt;1.0.3&gt;:auth&lt;zef:tony-o&gt;
===&gt; Testing: Event::Emitter::Inter-Process:ver&lt;1.0.1&gt;:auth&lt;zef:tony-o&gt;
===&gt; Testing [OK] for Event::Emitter::Inter-Process:ver&lt;1.0.1&gt;:auth&lt;zef:tony-o&gt;
===&gt; Installing: Event::Emitter:ver&lt;1.0.3&gt;:auth&lt;zef:tony-o&gt;
===&gt; Installing: Event::Emitter::Inter-Process:ver&lt;1.0.1&gt;:auth&lt;zef:tony-o&gt;</code></pre>
<p>Now you should be able to just run your app:</p>
<pre><code>$ raku parent.raku
child echo: hello
child echo: world
hello
world</code></pre>
<p>And then if you disable the environment:</p>
<pre><code>$ envy disable tutorial
==&gt; Disabled repositories: tutorial
$ raku parent.raku
===SORRY!=== Error while compiling /private/tmp/parent.raku
Could not find Event::Emitter::Inter-Process in:
    Envy&lt;3697577031872&gt;
    ...
at /private/tmp/parent.raku:1</code></pre>
<h2 id="other-notes-about-envy">Other Notes About Envy</h2>
<p>Envy is in beta, there's likely some things that don't work quite right. PRs are most welcome and bugs are appropriately welcome. Both can be submitted <a href="https://github.com/tony-o/envy/">here</a>.</p>


    </div>
    <div id="footer">
      <h6>// social twitter:<a href="https://twitter.com/oynoto">@oynoto</a>, patreon:<a href="https://www.patreon.com/oynot">@oynot</a>, github:<a href="https://github.com/tony-o">tony-o</a></h6>
    </div>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/highlight.min.js"></script>
    <script src="/s/hljs-raku.js"></script>
    <script>
      hljs.registerLanguage("raku", hljs_raku);
      (function(){
        languages = {}
        pres      = document.getElementsByTagName("pre");
        for(i = 0; i < hljs.listLanguages().length; i++){
          languages['language-' + hljs.listLanguages()[i]] = 1;
        }
        for(i = 0; i < pres.length; i++){
          pre = pres[i];
          cn  = 'language-plaintext';
          ls  = (pre.getAttribute("class") || 'plaintext').split(' ');
          for(j = 0; j < ls.length; j++){
            if(languages['language-' + ls[j]]){
              cn = 'language-' + ls[j];
              break;
            }
          }
          codes = pre.getElementsByTagName("code")
          for(j = 0; j < codes.length; j++){
            codes[j].setAttribute("class", (codes[j].getAttribute("class") + " hljs " + cn).trim())
          }
        }
        hljs.highlightAll();
      })();
    </script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FKJQZPJ2XK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-FKJQZPJ2XK');
    </script>

  </body>
</html>
